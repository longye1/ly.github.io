<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>管理后台 - 龙野插件商店</title>
  <link rel="shortcut icon" href="https://youke2.picui.cn/s1/2025/12/27/694f892215f19.png">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Microsoft YaHei", Arial, sans-serif;
    }
    body {
      background-color: #f5f5f5;
      color: #333;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      overflow: hidden;
    }
    .admin-header {
      background-color: #2c82c9;
      color: #fff;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .admin-title {
      font-size: 18px;
      font-weight: 500;
    }
    .back-home {
      color: #fff;
      text-decoration: none;
      font-size: 14px;
      background-color: rgba(255,255,255,0.2);
      padding: 6px 12px;
      border-radius: 4px;
    }
    .admin-nav {
      display: flex;
      border-bottom: 1px solid #eee;
      background-color: #f9f9f9;
    }
    .nav-item {
      padding: 12px 20px;
      cursor: pointer;
      font-size: 14px;
      color: #666;
      border-bottom: 2px solid transparent;
    }
    .nav-item.active {
      color: #2c82c9;
      border-bottom: 2px solid #2c82c9;
      font-weight: 500;
    }
    .admin-content {
      padding: 20px;
      display: none;
    }
    .admin-content.active {
      display: block;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
      color: #333;
      font-weight: 500;
    }
    .form-input, .form-textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      color: #333;
    }
    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }
    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn-primary {
      background-color: #2c82c9;
      color: #fff;
    }
    .btn-primary:hover {
      background-color: #2471a3;
    }
    .btn-danger {
      background-color: #e25041;
      color: #fff;
    }
    .btn-danger:hover {
      background-color: #c9302c;
    }
    .plugin-list {
      margin
    /* 响应式适配 */
    @media (max-width: 768px) {
      .admin-nav {
        flex-wrap: wrap;
      }
      .plugin-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      .plugin-actions {
        width: 100%;
        justify-content: flex-end;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- 后台头部 -->
    <div class="admin-header">
      <div class="admin-title">管理后台</div>
      <a href="../index.html" class="back-home">返回首页</a>
    </div>

    <!-- 后台导航 -->
    <div class="admin-nav">
      <div class="nav-item active" onclick="switchTab('plugin-manage')">插件管理</div>
      <div class="nav-item" onclick="switchTab('content-edit')">内容编辑</div>
      <div class="nav-item" onclick="switchTab('pay-config')">收款码配置</div>
    </div>

    <!-- 插件管理面板 -->
    <div class="admin-content active" id="plugin-manage">
      <h3 style="margin-bottom: 15px; font-size: 16px;">插件管理</h3>
      <div class="form-group">
        <label class="form-label">插件名称</label>
        <input type="text" class="form-input" id="pluginName" placeholder="请输入插件名称">
      </div>
      <div class="form-group">
        <label class="form-label">插件描述</label>
        <textarea class="form-textarea" id="pluginDesc" placeholder="请输入插件描述"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">插件价格</label>
        <input type="number" step="0.01" class="form-input" id="pluginPrice" placeholder="请输入插件价格（免费填0）">
      </div>
      <div class="form-group">
        <label class="form-label">插件类型</label>
        <select class="form-input" id="pluginType">
          <option value="esx-plugin">ESX插件</option>
          <option value="free-plugin">免费插件</option>
        </select>
      </div>
      <button class="btn btn-primary" onclick="savePlugin()">保存插件</button>
      <div class="success-tip" id="pluginSuccess">插件保存成功！</div>
      <div class="error-tip" id="pluginError">请填写完整插件信息！</div>

      <!-- 插件列表 -->
      <div class="plugin-list" id="pluginList">
        <!-- 插件列表动态渲染 -->
      </div>
    </div>

    <!-- 内容编辑面板（技术服务+联系我们） -->
    <div class="admin-content" id="content-edit">
      <h3 style="margin-bottom: 15px; font-size: 16px;">技术服务内容编辑</h3>
      <div class="form-group">
        <label class="form-label">服务端搭建描述</label>
        <textarea class="form-textarea" id="serviceBuild" placeholder="请输入服务端搭建的描述内容"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">插件修复描述</label>
        <textarea class="form-textarea" id="serviceFix" placeholder="请输入插件修复的描述内容"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">插件魔改描述</label>
        <textarea class="form-textarea" id="serviceModify" placeholder="请输入插件魔改的描述内容"></textarea>
      </div>
      <div class="form-group">
        <label class="form-label">插件定制描述</label>
        <textarea class="form-textarea" id="serviceCustom" placeholder="请输入插件定制的描述内容"></textarea>
      </div>

      <h3 style="margin: 20px 0 15px; font-size: 16px;">联系我们内容编辑</h3>
      <div class="form-group">
        <label class="form-label">联系方式</label>
        <input type="text" class="form-input" id="contactInfo" placeholder="请输入联系方式（如：企鹅: <span>3196990181</span>）">
      </div>
      <div class="form-group">
        <label class="form-label">支持支付方式</label>
        <input type="text" class="form-input" id="contactPay" placeholder="请输入支持的支付方式（如：微信支付、支付宝）">
      </div>
      <div class="form-group">
        <label class="form-label">服务保障</label>
        <input type="text" class="form-input" id="contactGuarantee" placeholder="请输入服务保障内容（如：7x12小时技术咨询、30天质保）">
      </div>

      <button class="btn btn-primary" onclick="saveContent()">保存内容</button>
      <div class="success-tip" id="contentSuccess">内容保存成功！</div>
      <div class="error-tip" id="contentError">保存失败，请检查输入！</div>
    </div>

    <!-- 收款码配置面板 -->
    <div class="admin-content" id="pay-config">
      <h3 style="margin-bottom: 15px; font-size: 16px;">收款码配置</h3>
      <div class="form-group">
        <label class="form-label">微信收款码图片链接</label>
        <input type="text" class="form-input" id="wechatQrcodeUrl" placeholder="请输入微信收款码图片的完整URL">
      </div>
      <div class="form-group">
        <label class="form-label">支付宝收款码图片链接</label>
        <input type="text" class="form-input" id="alipayQrcodeUrl" placeholder="请输入支付宝收款码图片的完整URL">
      </div>

      <button class="btn btn-primary" onclick="savePayQrcode()">保存收款码配置</button>
      <div class="success-tip" id="paySuccess">收款码配置保存成功！</div>
      <div class="error-tip" id="payError">保存失败，请检查链接格式！</div>
    </div>
  </div>

  <script>
    // 全局变量：编辑插件ID
    let editPluginId = null;

    // ========== 核心功能：标签切换 ==========
    function switchTab(tabId) {
      // 1. 移除所有导航激活状态
      const navItems = document.querySelectorAll('.nav-item');
      navItems.forEach(item => item.classList.remove('active'));
      // 2. 激活当前点击的导航
      event.target.classList.add('active');

      // 3. 移除所有内容面板显示状态
      const contentPanels = document.querySelectorAll('.admin-content');
      contentPanels.forEach(panel => panel.classList.remove('active'));
      // 4. 显示当前选中的面板
      document.getElementById(tabId).classList.add('active');

      // 5. 初始化对应面板数据
      if (tabId === 'plugin-manage') loadPluginList();
      if (tabId === 'content-edit') loadContentData();
      if (tabId === 'pay-config') loadPayQrcodeData();
    }

    // ========== 插件管理功能 ==========
    // 加载插件列表
    function loadPluginList() {
      try {
        const pluginList = JSON.parse(localStorage.getItem('pluginList') || '[]');
        const pluginListEl = document.getElementById('pluginList');
        
        // 清空列表
        pluginListEl.innerHTML = '';

        // 无插件提示
        if (pluginList.length === 0) {
          pluginListEl.innerHTML = '<div class="plugin-item"><p style="color:#666;">暂无插件，请添加</p></div>';
          return;
        }

        // 渲染插件列表
        pluginList.forEach(plugin => {
          const pluginItem = document.createElement('div');
          pluginItem.className = 'plugin-item';
          pluginItem.innerHTML = `
            <div class="plugin-info">
              <div class="plugin-name">${plugin.name}（${plugin.type === 'esx-plugin' ? 'ESX插件' : '免费插件'}）</div>
              <div class="plugin-desc">${plugin.desc} | 价格：¥${plugin.price.toFixed(2)}</div>
            </div>
            <div class="plugin-actions">
              <button class="btn btn-primary" onclick="editPlugin('${plugin.id}')">编辑</button>
              <button class="btn btn-danger" onclick="deletePlugin('${plugin.id}')">删除</button>
            </div>
          `;
          pluginListEl.appendChild(pluginItem);
        });
      } catch (e) {
        console.error('加载插件列表失败：', e);
        showTip('pluginError', '加载插件列表失败，请刷新页面！');
      }
    }

    // 保存插件（新增/编辑）
    function savePlugin() {
      try {
        const name = document.getElementById('pluginName').value.trim();
        const desc = document.getElementById('pluginDesc').value.trim();
        const price = parseFloat(document.getElementById('pluginPrice').value) || 0;
        const type = document.getElementById('pluginType').value;

        // 验证必填项
        if (!name || !desc) {
          showTip('pluginError');
          return;
        }

        // 获取现有插件列表
        let pluginList = JSON.parse(localStorage.getItem('pluginList') || '[]');

        if (editPluginId) {
          // 编辑模式：替换原有插件
          pluginList = pluginList.map(plugin => {
            if (plugin.id === editPluginId) {
              return { ...plugin, name, desc, price, type };
            }
            return plugin;
          });
          editPluginId = null; // 重置编辑ID
        } else {
          // 新增模式：添加新插件
          pluginList.push({
            id: Date.now().toString(), // 用时间戳作为唯一ID
            name,
            desc,
            price,
            type
          });
        }

        // 保存到本地存储
        localStorage.setItem('pluginList', JSON.stringify(pluginList));

        // 清空表单
        document.getElementById('pluginName').value = '';
        document.getElementById('pluginDesc').value = '';
        document.getElementById('pluginPrice').value = '';
        document.getElementById('pluginType').value = 'esx-plugin';

        // 刷新列表 + 显示成功提示
        loadPluginList();
        showTip('pluginSuccess');
      } catch (e) {
        console.error('保存插件失败：', e);
        showTip('pluginError', '保存插件失败，请检查输入！');
      }
    }

    // 编辑插件
    function editPlugin(id) {
      try {
        const pluginList = JSON.parse(localStorage.getItem('pluginList') || '[]');
        const plugin = pluginList.find(item => item.id === id);
        
        if (plugin) {
          // 填充表单
          document.getElementById('pluginName').value = plugin.name;
          document.getElementById('pluginDesc').value = plugin.desc;
          document.getElementById('pluginPrice').value = plugin.price;
          document.getElementById('pluginType').value = plugin.type;
          // 设置编辑ID
          editPluginId = id;
          // 滚动到表单顶部
          document.getElementById('plugin-manage').scrollTop = 0;
        }
      } catch (e) {
        console.error('编辑插件失败：', e);
        showTip('pluginError', '加载插件数据失败！');
      }
    }

    // 删除插件
    function deletePlugin(id) {
      if (!confirm('确定要删除该插件吗？删除后无法恢复！')) return;

      try {
        let pluginList = JSON.parse(localStorage.getItem('pluginList') || '[]');
        // 过滤掉要删除的插件
        pluginList = pluginList.filter(plugin => plugin.id !== id);
        // 保存修改后的列表
        localStorage.setItem('pluginList', JSON.stringify(pluginList));
        // 刷新列表
        loadPluginList();
      } catch (e) {
        console.error('删除插件失败：', e);
        alert('删除插件失败，请重试！');
      }
    }

    // ========== 内容编辑功能 ==========
    // 加载内容编辑数据
    function loadContentData() {
      try {
        // 加载技术服务内容
        const serviceContent = JSON.parse(localStorage.getItem('serviceContent') || '{}');
        if (serviceContent.build) document.getElementById('serviceBuild').value = serviceContent.build;
        if (serviceContent.fix) document.getElementById('serviceFix').value = serviceContent.fix;
        if (serviceContent.modify) document.getElementById('serviceModify').value = serviceContent.modify;
        if (serviceContent.custom) document.getElementById('serviceCustom').value = serviceContent.custom;

        // 加载联系我们内容
        const contactContent = JSON.parse(localStorage.getItem('contactContent') || '{}');
        if (contactContent.info) document.getElementById('contactInfo').value = contactContent.info;
        if (contactContent.pay) document.getElementById('contactPay').value = contactContent.pay;
        if (contactContent.guarantee) document.getElementById('contactGuarantee').value = contactContent.guarantee;
      } catch (e) {
        console.error('加载内容编辑数据失败：', e);
        showTip('contentError', '加载数据失败，请刷新页面！');
      }
    }

    // 保存内容编辑数据
    function saveContent() {
      try {
        // 收集技术服务内容
        const serviceContent = {
          build: document.getElementById('serviceBuild').value.trim(),
          fix: document.getElementById('serviceFix').value.trim(),
          modify: document.getElementById('serviceModify').value.trim(),
          custom: document.getElementById('serviceCustom').value.trim()
        };

        // 收集联系我们内容
        const contactContent = {
          info: document.getElementById('contactInfo').value.trim(),
          pay: document.getElementById('contactPay').value.trim(),
          guarantee: document.getElementById('contactGuarantee').value.trim()
        };

        // 验证（至少填写一项）
        if (!Object.values(serviceContent).some(v => v) && !Object.values(contactContent).some(v => v)) {
          showTip('contentError');
          return;
        }

        // 保存到本地存储
        localStorage.setItem('serviceContent', JSON.stringify(serviceContent));
        localStorage.setItem('contactContent', JSON.stringify(contactContent));

        // 显示成功提示
        showTip('contentSuccess');
      } catch (e) {
        console.error('保存内容失败：', e);
        showTip('contentError', '保存失败，请检查输入格式！');
      }
    }

    // ========== 收款码配置功能 ==========
    // 加载收款码配置数据
    function loadPayQrcodeData() {
      try {
        const payQrcode = JSON.parse(localStorage.getItem('payQrcode') || '{}');
        if (payQrcode.wechat) document.getElementById('wechatQrcodeUrl').value = payQrcode.wechat;
        if (payQrcode.alipay) document.getElementById('alipayQrcodeUrl').value = payQrcode.alipay;
      } catch (e) {
        console.error('加载收款码配置失败：', e);
        showTip('payError', '加载配置失败，请刷新页面！');
      }
    }

    // 保存收款码配置
    function savePayQrcode() {
      try {
        const wechatUrl = document.getElementById('wechatQrcodeUrl').value.trim();
        const alipayUrl = document.getElementById('alipayQrcodeUrl').value.trim();

        // 简单验证URL格式（包含http/https）
        const isUrlValid = (url) => {
          return url === '' || /^https?:\/\/.+$/.test(url);
        };

        if (!isUrlValid(wechatUrl) || !isUrlValid(alipayUrl)) {
          showTip('payError', '请输入有效的图片URL（以http/https开头）！');
          return;
        }

        // 保存到本地存储
        const payQrcode = {
          wechat: wechatUrl,
          alipay: alipayUrl
        };
        localStorage.setItem('payQrcode', JSON.stringify(payQrcode));

        // 显示成功提示
        showTip('paySuccess');
      } catch (e) {
        console.error('保存收款码配置失败：', e);
        showTip('payError', '保存失败，请重试！');
      }
    }

    // ========== 通用工具：提示框显示 ==========
    function showTip(tipId, customText = '') {
      // 隐藏所有提示框
      const allTips = document.querySelectorAll('.success-tip, .error-tip');
      allTips.forEach(tip => tip.style.display = 'none');

      // 显示目标提示框
      const tipEl = document.getElementById(tipId);
      if (customText) {
        tipEl.textContent = customText;
      }
      tipEl.style.display = 'block';

      // 3秒后自动隐藏
      setTimeout(() => {
        tipEl.style.display = 'none';
      }, 3000);
    }

    // ========== 页面初始化 ==========
    window.onload = function() {
      // 初始化插件列表
      loadPluginList();
    };
  </script>
</body>
</html>