<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>longyechajianshangdian · 龙野插件商店</title>
  <link rel="shortcut icon" href="https://youke2.picui.cn/s1/2025/12/27/694f892215f19.png">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: "Microsoft YaHei", Arial, sans-serif;
    }
    body {
      background-color: #f5f5f5;
      color: #333;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* 顶部导航（带用户信息） */
    .tab-nav {
      background-color: #fff;
      border-bottom: 1px solid #eee;
      padding: 10px 0;
    }
    .tab-nav .container {
      display: flex;
      align-items: center;
    }
    .nav-list {
      list-style: none;
      display: flex;
      gap: 20px;
    }
    .nav-list li {
      cursor: pointer;
      font-size: 14px;
      padding: 5px 0;
    }
    .nav-list li.active {
      color: #2c82c9;
      border-bottom: 2px solid #2c82c9;
    }
    .user-info {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
    }
    .logout-btn {
      color: #e25041;
      cursor: pointer;
    }
    .admin-entry {
      color: #2c82c9;
      cursor: pointer;
      margin-left: 10px;
      display: none; /* 默认隐藏，管理员显示 */
    }

    /* 标签内容区 */
    .tab-content {
      margin: 30px 0;
    }
    .tab-panel {
      display: none;
    }
    .tab-panel.active {
      display: block;
    }

    /* 主内容布局 */
    .main-wrapper {
      display: flex;
      gap: 30px;
    }
    .content-left {
      flex: 2;
    }
    .content-right {
      flex: 1;
    }

    /* 通用卡片样式 */
    .card {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      margin-bottom: 20px;
    }
    .card-title {
      text-align: center;
      font-size: 18px;
      color: #2c82c9;
      margin-bottom: 10px;
    }
    .card-desc {
      font-size: 14px;
      color: #666;
      line-height: 1.6;
      text-align: center;
      margin-bottom: 15px;
    }

    /* 服务卡片 */
    .service-item h3 {
      font-size: 16px;
      color: #2c82c9;
      margin-bottom: 5px;
    }
    .service-item p {
      font-size: 14px;
      color: #666;
      line-height: 1.6;
    }

    /* 插件卡片 */
    .plugin-item h3 {
      font-size: 16px;
      color: #2c82c9;
      margin-bottom: 8px;
    }
    .plugin-item p {
      font-size: 14px;
      color: #666;
      line-height: 1.6;
      margin-bottom: 12px;
    }
    .plugin-item .price {
      color: #e25041;
      font-weight: 500;
      margin-right: 10px;
    }
    .buy-btn {
      display: inline-block;
      padding: 6px 12px;
      background-color: #2c82c9;
      color: #fff;
      text-decoration: none;
      border-radius: 4px;
      font-size: 13px;
      cursor: pointer;
    }
    .buy-btn:hover {
      background-color: #2471a3;
    }

    /* 侧边栏样式 */
    .sidebar-widget h3 {
      font-size: 16px;
      color: #333;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    .contact-info {
      font-size: 14px;
      color: #333;
    }
    .contact-info span {
      color: #2c82c9;
      font-weight: 500;
    }
    .payment-methods {
      display: flex;
      gap: 20px;
      margin-bottom: 10px;
      font-size: 14px;
      color: #333;
    }
    .payment-methods span {
      color: #2c82c9;
      font-weight: 500;
    }
    .service-ensure ul {
      list-style: disc;
      padding-left: 20px;
      font-size: 14px;
      color: #666;
      line-height: 1.8;
    }

    /* 响应式适配 */
    @media (max-width: 768px) {
      .main-wrapper {
        flex-direction: column;
      }
      .nav-list {
        flex-wrap: wrap;
      }
      .user-info {
        margin-left: 0;
        width: 100%;
        margin-top: 10px;
      }
    }

    /* 支付弹窗样式 */
    .pay-modal-mask {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.7);
      z-index: 9999;
      display: none;
      justify-content: center;
      align-items: center;
    }
    .pay-modal {
      background-color: #fff;
      width: 90%;
      max-width: 500px;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    }
    .pay-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }
    .pay-modal-title {
      font-size: 18px;
      font-weight: 500;
      color: #333;
    }
    .close-modal {
      width: 30px;
      height: 30px;
      line-height: 30px;
      text-align: center;
      border-radius: 50%;
      background-color: #f5f5f5;
      color: #666;
      cursor: pointer;
      font-size: 20px;
    }
    .pay-tabs {
      display: flex;
      border-bottom: 1px solid #eee;
      margin-bottom: 15px;
    }
    .pay-tab-item {
      padding: 8px 20px;
      cursor: pointer;
      font-size: 14px;
      color: #666;
      border-bottom: 2px solid transparent;
    }
    .pay-tab-item.active {
      color: #2c82c9;
      border-bottom: 2px solid #2c82c9;
      font-weight: 500;
    }
    .pay-content {
      display: none;
      text-align: center;
    }
    .pay-content.active {
      display: block;
    }
    .pay-qrcode {
      width: 200px;
      height: 200px;
      margin: 0 auto 10px;
      border: 1px solid #eee;
      padding: 5px;
    }
    .pay-qrcode img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .pay-amount {
      font-size: 16px;
      color: #e25041;
      font-weight: 500;
      margin-bottom: 5px;
    }
    .pay-desc {
      font-size: 14px;
      color: #666;
      line-height: 1.6;
    }
    .pay-tip {
      font-size: 12px;
      color: #999;
      margin-top: 15px;
      text-align: center;
    }
  </style>
</head>
<body>
  <!-- 登录验证：简化版（无报错） -->
  <script>
    // 屏蔽DevTools报错
    try {
      if (window.runtime && window.runtime.lastError) {
        delete window.runtime.lastError;
      }
    } catch (e) {}

    // 简化登录验证逻辑（避免中断）
    let isLogin = false;
    let currentUser = { username: '', role: 'user' };
    try {
      isLogin = localStorage.getItem('isLogin') === 'true';
      currentUser = JSON.parse(localStorage.getItem('currentUser') || '{"username":"","role":"user"}');
    } catch (e) {
      // 解析失败时强制跳转到登录页
      window.location.href = 'login.html';
    }

    // 未登录强制跳转
    if (!isLogin) {
      window.location.assign('login.html');
    }
  </script>

  <!-- 顶部标签导航 -->
  <div class="tab-nav">
    <div class="container">
      <ul class="nav-list">
        <li class="tab-item active" data-tab="home">首页</li>
        <li class="tab-item" data-tab="esx-plugin">ESX插件</li>
        <li class="tab-item" data-tab="free-plugin">免费插件</li>
        <li class="tab-item" data-tab="service">技术服务</li>
        <li class="tab-item" data-tab="contact">联系我们</li>
      </ul>
      <div class="user-info">
        <span>欢迎：<b id="username">未知用户</b></span>
        <span class="logout-btn" id="logoutBtn">退出登录</span>
        <span class="admin-entry" id="adminEntry">管理后台</span>
      </div>
    </div>
  </div>

  <!-- 标签内容区 -->
  <div class="tab-content container">
    <!-- 首页面板 -->
    <div class="tab-panel active" id="home">
      <div class="main-wrapper">
        <div class="content-left">
          <div class="card">
            <h2 class="card-title">承接ESX & QB</h2>
            <p class="card-desc">技术服务 服务端搭建 插件修复 魔改 定制</p>
          </div>
          <!-- 技术服务（动态渲染） -->
          <div class="card service-item" id="serviceBuildCard">
            <h3>服务端搭建</h3>
            <p>专业搭建ESX/QB框架服务端，优化配置，确保稳定运行</p>
          </div>
          <div class="card service-item" id="serviceFixCard">
            <h3>插件修复</h3>
            <p>快速定位并修复插件BUG，解决兼容性问题，恢复功能正常使用</p>
          </div>
          <div class="card service-item" id="serviceModifyCard">
            <h3>插件魔改</h3>
            <p>根据需求修改插件功能，扩展特性，满足个性化使用场景</p>
          </div>
          <div class="card service-item" id="serviceCustomCard">
            <h3>插件定制</h3>
            <p>从零开发专属插件，完全匹配业务需求，提供完整技术支持</p>
          </div>
        </div>
        <div class="content-right">
          <!-- 联系我们（动态渲染） -->
          <div class="card sidebar-widget" id="contactInfoCard">
            <h3>联系方式</h3>
            <div class="contact-info">
              企鹅: <span>3196990181</span> 企鹅:<span>2107096857</span>
            </div>
          </div>
          <div class="card sidebar-widget" id="payMethodCard">
            <h3>支持支付</h3>
            <div class="payment-methods">
              <span>微信支付</span>
              <span>支付宝</span>
            </div>
          </div>
          <div class="card sidebar-widget" id="serviceGuaranteeCard">
            <h3>服务保障</h3>
            <div class="service-ensure">
              <ul>
                <li>7x12小时技术咨询</li>
                <li>搭建完成后30天质保</li>
                <li>定制插件提供终身维护</li>
                <li>一对一专属服务对接</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ESX插件面板（动态渲染） -->
    <div class="tab-panel" id="esx-plugin">
      <div class="main-wrapper">
        <div class="content-left">
          <div class="card">
            <h2 class="card-title">ESX插件商城</h2>
            <p class="card-desc">点击“立即购买”联系客服支付，支付完成后获取插件包</p>
            <div id="esxPluginList">
              <!-- ESX插件列表动态渲染 -->
            </div>
          </div>
        </div>
        <div class="content-right">
          <div class="card sidebar-widget" id="esxContactInfo">
            <h3>联系方式</h3>
            <div class="contact-info">
              企鹅: <span>3196990181</span> 企鹅:<span>2107096857</span>
            </div>
          </div>
          <div class="card sidebar-widget" id="esxPayMethod">
            <h3>支持支付</h3>
            <div class="payment-methods">
              <span>微信支付</span>
              <span>支付宝</span>
            </div>
          </div>
          <div class="card sidebar-widget" id="esxServiceGuarantee">
            <h3>服务保障</h3>
            <div class="service-ensure">
              <ul>
                <li>插件永久更新</li>
                <li>购买后3天无理由退款</li>
                <li>一对一安装指导</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 免费插件面板（动态渲染） -->
    <div class="tab-panel" id="free-plugin">
      <div class="main-wrapper">
        <div class="content-left">
          <div class="card">
            <h2 class="card-title">免费插件</h2>
            <p class="card-desc">点击“立即获取”联系客服领取插件</p>
            <div id="freePluginList">
              <!-- 免费插件列表动态渲染 -->
            </div>
          </div>
        </div>
        <div class="content-right">
          <div class="card sidebar-widget" id="freeContactInfo">
            <h3>联系方式</h3>
            <div class="contact-info">
              企鹅: <span>3196990181</span> 企鹅:<span>2107096857</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- 技术服务面板 -->
    <div class="tab-panel" id="service">
      <div class="card">
        <h2 class="card-title">技术服务</h2>
        <p class="card-desc">如需技术服务，请联系企鹅：3196990181 企鹅:2107096857</p>
      </div>
    </div>

    <!-- 联系我们面板 -->
    <div class="tab-panel" id="contact">
      <div class="card">
        <h2 class="card-title">联系我们</h2>
        <p class="card-desc">企鹅：3196990181 企鹅:2107096857</p>
      </div>
    </div>
  </div>

  <!-- 支付弹窗 -->
  <div class="pay-modal-mask" id="payModal">
    <div class="pay-modal">
      <div class="pay-modal-header">
        <div class="pay-modal-title" id="payModalTitle">插件购买 - 支付确认</div>
        <div class="close-modal" id="closePayModal">×</div>
      </div>
      <div class="pay-tabs">
        <div class="pay-tab-item active" onclick="switchPayTab('wechat')">微信支付</div>
        <div class="pay-tab-item" onclick="switchPayTab('alipay')">支付宝支付</div>
      </div>
      <div class="pay-content active" id="wechatPay">
        <div class="pay-qrcode">
          <img src="https://youke2.picui.cn/s1/2025/12/27/694f892215f19.png" alt="微信收款码" id="wechatQrcode">
        </div>
        <div class="pay-amount" id="wechatAmount">¥0.00</div>
        <div class="pay-desc" id="wechatDesc">请使用微信扫描上方二维码完成支付</div>
      </div>
      <div class="pay-content" id="alipayPay">
        <div class="pay-qrcode">
          <img src="https://youke2.picui.cn/s1/2025/12/27/694f892215f19.png" alt="支付宝收款码" id="alipayQrcode">
        </div>
        <div class="pay-amount" id="alipayAmount">¥0.00</div>
        <div class="pay-desc" id="alipayDesc">请使用支付宝扫描上方二维码完成支付</div>
      </div>
      <div class="pay-tip">支付完成后联系客服（企鹅: 3196990181 企鹅:2107096857）核实发货</div>
    </div>
  </div>

  <script>
    // ========== 基础初始化 ==========
    // 初始化用户信息
    try {
      const user = JSON.parse(localStorage.getItem('currentUser') || '{"username":"未知用户","role":"user"}');
      document.getElementById('username').textContent = user.username || '未知用户';
      // 管理员显示后台入口
      if (user.role === 'admin') {
        document.getElementById('adminEntry').style.display = 'inline-block';
      }
    } catch (e) {
      document.getElementById('username').textContent = '未知用户';
    }

    // 标签切换功能
    const tabItems = document.querySelectorAll('.tab-item');
    tabItems.forEach(item => {
      item.addEventListener('click', function() {
        // 移除所有激活状态
        tabItems.forEach(i => i.classList.remove('active'));
        document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
        // 激活当前标签
        this.classList.add('active');
        const tabId = this.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');
      });
    });

    // 退出登录
    document.getElementById('logoutBtn').addEventListener('click', function() {
      localStorage.removeItem('isLogin');
      localStorage.removeItem('currentUser');
      window.location.href = 'login.html';
    });

    // 管理后台入口
    document.getElementById('adminEntry').addEventListener('click', function() {
      const user = JSON.parse(localStorage.getItem('currentUser') || '{"role":"user"}');
      if (user.role === 'admin') {
        window.location.href = 'admin/plugin-manage.html';
      } else {
        alert('无管理员权限！');
      }
    });

    // ========== 动态渲染内容 ==========
    // 渲染技术服务内容
    function renderServiceContent() {
      try {
        const serviceContent = JSON.parse(localStorage.getItem('serviceContent') || '{}');
        if (serviceContent.build) document.getElementById('serviceBuildCard').querySelector('p').textContent = serviceContent.build;
        if (serviceContent.fix) document.getElementById('serviceFixCard').querySelector('p').textContent = serviceContent.fix;
        if (serviceContent.modify) document.getElementById('serviceModifyCard').querySelector('p').textContent = serviceContent.modify;
        if (serviceContent.custom) document.getElementById('serviceCustomCard').querySelector('p').textContent = serviceContent.custom;
      } catch (e) {
        console.log('渲染技术服务内容失败：', e);
      }
    }

    // 渲染联系我们内容（优先级：后台配置 > 默认值）
    function renderContactContent() {
      try {
        const contactContent = JSON.parse(localStorage.getItem('contactContent') || '{}');
        // 联系方式：后台配置优先，无配置则用默认双企鹅号
        const defaultContact = '企鹅: <span>3196990181</span> 企鹅:<span>2107096857</span>';
        const contactHtml = contactContent.info || defaultContact;
        
        document.getElementById('contactInfoCard').querySelector('.contact-info').innerHTML = contactHtml;
        document.getElementById('esxContactInfo').querySelector('.contact-info').innerHTML = contactHtml;
        document.getElementById('freeContactInfo').querySelector('.contact-info').innerHTML = contactHtml;

        // 支付方式：后台配置优先
        if (contactContent.pay) {
          const payItems = contactContent.pay.split('、');
          let payHtml = '';
          payItems.forEach(item => payHtml += `<span>${item}</span>`);
          document.getElementById('payMethodCard').querySelector('.payment-methods').innerHTML = payHtml;
          document.getElementById('esxPayMethod').querySelector('.payment-methods').innerHTML = payHtml;
        }

        // 服务保障：后台配置优先
        if (contactContent.guarantee) {
          const guaranteeList = contactContent.guarantee.split('、');
          let guaranteeHtml = '';
          guaranteeList.forEach(item => guaranteeHtml += `<li>${item}</li>`);
          document.getElementById('serviceGuaranteeCard').querySelector('ul').innerHTML = guaranteeHtml;
        }
      } catch (e) {
        console.log('渲染联系我们内容失败：', e);
      }
    }

    // 渲染插件列表
    function renderPluginList() {
      try {
        const pluginList = JSON.parse(localStorage.getItem('pluginList') || '[]');
        const esxList = document.getElementById('esxPluginList');
        const freeList = document.getElementById('freePluginList');
        
        // 清空列表
        esxList.innerHTML = '';
        freeList.innerHTML = '';

        // 无插件提示
        if (pluginList.length === 0) {
          esxList.innerHTML = '<p style="text-align:center; color:#666; padding:20px 0;">暂无ESX插件</p>';
          freeList.innerHTML = '<p style="text-align:center; color:#666; padding:20px 0;">暂无免费插件</p>';
          return;
        }

        // 分类渲染插件
        pluginList.forEach(plugin => {
          const pluginItem = document.createElement('div');
          pluginItem.className = 'plugin-item';
          pluginItem.innerHTML = `
            <h3>${plugin.name}</h3>
            <p>${plugin.desc}</p>
            <p class="price">价格：¥${plugin.price.toFixed(2)}</p>
            <a class="buy-btn" onclick="openPayModal('${plugin.name}', ${plugin.price}, '${plugin.type}')">立即购买</a>
          `;
          
          if (plugin.type === 'esx-plugin') {
            esxList.appendChild(pluginItem);
          } else {
            freeList.appendChild(pluginItem);
            // 免费插件修改按钮文字和价格
            pluginItem.querySelector('.price').textContent = '价格：免费';
            pluginItem.querySelector('.buy-btn').textContent = '立即获取';
          }
        });
      } catch (e) {
        console.log('渲染插件列表失败：', e);
      }
    }

    // ========== 支付弹窗功能 ==========
    let currentPayPlugin = { payType: 'wechat' };

    // 打开支付弹窗
    function openPayModal(pluginName, pluginPrice, pluginType) {
      currentPayPlugin = {
        name: pluginName,
        price: pluginPrice,
        type: pluginType,
        payType: 'wechat'
      };

      // 更新弹窗标题和金额
      const modalTitle = document.getElementById('payModalTitle');
      const wechatAmount = document.getElementById('wechatAmount');
      const alipayAmount = document.getElementById('alipayAmount');
      const wechatDesc = document.getElementById('wechatDesc');
      const alipayDesc = document.getElementById('alipayDesc');

      if (pluginType === 'free-plugin') {
        modalTitle.textContent = `${pluginName} - 免费领取`;
        wechatAmount.textContent = '免费';
        alipayAmount.textContent = '免费';
        wechatDesc.textContent = `扫描二维码联系客服（企鹅: 3196990181 企鹅:2107096857）领取【${pluginName}】`;
        alipayDesc.textContent = `扫描二维码联系客服（企鹅: 3196990181 企鹅:2107096857）领取【${pluginName}】`;
      } else {
        modalTitle.textContent = `${pluginName} - 支付确认`;
        wechatAmount.textContent = `¥${pluginPrice.toFixed(2)}`;
        alipayAmount.textContent = `¥${pluginPrice.toFixed(2)}`;
        wechatDesc.textContent = `请支付 ¥${pluginPrice.toFixed(2)} 购买【${pluginName}】，支付完成后联系客服（企鹅: 3196990181 企鹅:2107096857）发货`;
        alipayDesc.textContent = `请支付 ¥${pluginPrice.toFixed(2)} 购买【${pluginName}】，支付完成后联系客服（企鹅: 3196990181 企鹅:2107096857）发货`;
      }

      // 加载收款码配置
      try {
        const qrcodeConfig = JSON.parse(localStorage.getItem('payQrcode') || '{}');
        if (qrcodeConfig.wechat) document.getElementById('wechatQrcode').src = qrcodeConfig.wechat;
        if (qrcodeConfig.alipay) document.getElementById('alipayQrcode').src = qrcodeConfig.alipay;
      } catch (e) {}

      // 显示弹窗
      document.getElementById('payModal').style.display = 'flex';
    }

    // 切换支付方式
    function switchPayTab(tabType) {
      // 切换标签激活状态
      document.querySelectorAll('.pay-tab-item').forEach(item => item.classList.remove('active'));
      document.querySelectorAll('.pay-content').forEach(content => content.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById(`${tabType}Pay`).classList.add('active');
      currentPayPlugin.payType = tabType;
    }

    // 关闭支付弹窗
    document.getElementById('closePayModal').addEventListener('click', function() {
      document.getElementById('payModal').style.display = 'none';
    });

    // 点击遮罩层关闭弹窗
    document.getElementById('payModal').addEventListener('click', function(e) {
      if (e.target === this) document.getElementById('payModal').style.display = 'none';
    });

    // ========== 页面初始化 ==========
    window.onload = function() {
      renderServiceContent();
      renderContactContent();
      renderPluginList();
    };
  </script>
</body>
</html>